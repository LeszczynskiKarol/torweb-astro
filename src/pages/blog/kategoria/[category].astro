---
// src/pages/blog/kategoria/[category].astro
import Layout from '../../../layouts/Layout.astro';
import Navbar from '../../../components/Navbar.astro';
import Footer from '../../../components/Footer.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

type BlogCategory = CollectionEntry<'blog'>['data']['category'];

// Interface Props
interface Props {
  categoryName: BlogCategory;
  posts: CollectionEntry<'blog'>[];
}


export async function getStaticPaths() {
  const posts = await getCollection('blog');
  
  // Jawne typowanie tablicy kategorii
  const categories: BlogCategory[] = [...new Set(posts.map(post => post.data.category))];
  
  return categories.map((category) => ({
    params: { category: category.toLowerCase().replace(/\s+/g, '-') },
    props: { 
      categoryName: category,
      posts: posts
        .filter(post => post.data.category === category)
        .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
    },
  }));
}


const { categoryName, posts } = Astro.props;

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('pl-PL', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  }).format(date);
};

const getReadingTime = (content: string) => {
  const words = content.split(/\s+/).length;
  return Math.ceil(words / 200);
};

// Opisy kategorii
const categoryDescriptions: Record<BlogCategory, string> =  {
  'Strony internetowe': 'Porady o tworzeniu skutecznych stron firmowych, landing page i wizytówek online.',
  'Sklepy internetowe': 'Wszystko o e-commerce: WooCommerce, własne sklepy, integracje płatności i Allegro.',
  'Aplikacje webowe': 'Tworzenie aplikacji webowych, SaaS, paneli administracyjnych i narzędzi biznesowych.',
  'Integracje AI': 'Praktyczne zastosowania sztucznej inteligencji w biznesie: chatboty, automatyzacja treści.',
  'Automatyzacja': 'Jak automatyzować procesy w firmie: Make.com, Zapier, własne integracje API.',
  'Pozycjonowanie': 'SEO dla firm z Torunia i okolic.',
  'Hosting i infrastruktura': 'AWS, CloudFront, bezpieczeństwo i wydajność stron internetowych.',
};
---

<Layout 
  title={`${categoryName} | Blog TorWeb.pl`}
  description={categoryDescriptions[categoryName] || `Artykuły z kategorii ${categoryName}`}
>
<Navbar />
  <main class="pt-32 pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Breadcrumbs -->
      <nav class="mb-8" aria-label="Breadcrumb">
        <ol class="flex items-center gap-2 text-sm text-muted">
          <li><a href="/" class="hover:text-accent transition-colors">Strona główna</a></li>
          <li class="text-faint">/</li>
          <li><a href="/blog" class="hover:text-accent transition-colors">Blog</a></li>
          <li class="text-faint">/</li>
          <li class="text-heading">{categoryName}</li>
        </ol>
      </nav>
      
      <!-- Header -->
      <header class="mb-12">
        <div class="inline-block px-4 py-2 bg-accent/10 text-accent rounded-full text-sm font-medium mb-4">
          Kategoria
        </div>
        <h1 class="text-4xl sm:text-5xl font-bold text-heading mb-4">
          {categoryName}
        </h1>
        <p class="text-lg text-muted max-w-2xl">
          {categoryDescriptions[categoryName] || `Wszystkie artykuły z kategorii ${categoryName}`}
        </p>
        <div class="mt-4 text-sm text-muted">
          {posts.length} {posts.length === 1 ? 'artykuł' : posts.length < 5 ? 'artykuły' : 'artykułów'}
        </div>
      </header>
      
      <!-- Posts Grid -->
      {posts.length === 0 ? (
        <div class="text-center py-16 bg-card border border-theme rounded-2xl">
          <p class="text-muted">Brak artykułów w tej kategorii.</p>
          <a href="/blog" class="text-accent hover:underline mt-2 inline-block">
            ← Wróć do wszystkich artykułów
          </a>
        </div>
      ) : (
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {posts.map(post => (
            <a 
              href={`/blog/${post.slug}`}
              class="group block bg-card border border-theme rounded-xl overflow-hidden hover:border-accent/50 transition-all duration-300"
            >
              {post.data.image ? (
                <div class="aspect-video bg-elevated overflow-hidden">
                  <img 
                    src={post.data.image} 
                    alt={post.data.imageAlt || post.data.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                </div>
              ) : (
                <div class="aspect-video bg-gradient-to-br from-emerald-500/20 to-sky-500/20 flex items-center justify-center">
                  <span class="text-4xl font-bold text-accent/30">
                    {post.data.title.substring(0, 2).toUpperCase()}
                  </span>
                </div>
              )}
              <div class="p-5">
                <div class="text-xs text-muted mb-3">
                  {formatDate(post.data.publishDate)}
                </div>
                <h2 class="text-lg font-bold text-heading mb-2 group-hover:text-accent transition-colors line-clamp-2">
                  {post.data.title}
                </h2>
                <p class="text-sm text-muted line-clamp-2 mb-3">
                  {post.data.description}
                </p>
                <div class="flex items-center justify-between text-sm">
                  <span class="text-muted">{getReadingTime(post.body || '')} min</span>
                  <span class="text-accent font-medium">→</span>
                </div>
              </div>
            </a>
          ))}
        </div>
      )}
      
      <!-- Back to Blog -->
      <div class="mt-12 text-center">
        <a 
          href="/blog" 
          class="inline-flex items-center gap-2 text-accent hover:underline"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"/>
          </svg>
          Wszystkie artykuły
        </a>
      </div>
      
    </div>
  </main>
  <Footer />
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>